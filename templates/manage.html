                    <thead>
                        <tr>
                            <th style="width: 5%">ID</th>
                            <th style="width: 15%">Topic</th>
                            <th style="width: 35%">Title</th>
                            <th style="width: 10%">Status</th>
                            <th style="width: 15%">Notes</th>
                            <th style="width: 10%">Source</th>
                            <th style="width: 10%">Date</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for link in links %}
                        <tr>
                            <td>{{ link.id }}</td>
                            <td>{{ link.topic }}</td>
                            <td>
                                <a href="{{ link.url }}" target="_blank" class="text-decoration-none">
                                    {{ link.title }}
                                </a>
                            </td>
                            <td>
                                <select class="form-select form-select-sm status-select" data-link-id="{{ link.id }}">
                                    <option value="new" {% if link.status == 'new' %}selected{% endif %}>New</option>
                                    <option value="read" {% if link.status == 'read' %}selected{% endif %}>Read</option>
                                    <option value="read-again" {% if link.status == 'read-again' %}selected{% endif %}>Read Again</option>
                                </select>
                            </td>
                            <td>{{ link.notes or '' }}</td>
                            <td>{{ link.source or '' }}</td>
                            <td class="text-nowrap">{{ link.date.split('T')[0] }}</td>
                            <td class="text-end">
                                <button type="button" class="btn btn-outline-primary btn-sm me-1" 
                                        data-bs-toggle="modal" 
                                        data-bs-target="#editLinkModal"
                                        data-link-id="{{ link.id }}"
                                        data-link-topic="{{ link.topic }}"
                                        data-link-url="{{ link.url }}"
                                        data-link-title="{{ link.title }}"
                                        data-link-status="{{ link.status }}"
                                        data-link-source="{{ link.source or '' }}"
                                        data-link-notes="{{ link.notes or '' }}">
                                    Edit
                                </button>
                                <form action="/link/delete/{{ link.id }}" method="post" class="d-inline" onsubmit="return confirm('Are you sure you want to delete this link?');">
                                    <button type="submit" class="btn btn-outline-danger btn-sm">Delete</button>
                                </form>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>

<!-- Edit Link Modal -->
<div class="modal fade" id="editLinkModal" tabindex="-1" aria-labelledby="editLinkModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editLinkModalLabel">Edit Link</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="editLinkForm" method="post">
                    <input type="hidden" id="editLinkId" name="id">
                    <div class="mb-3">
                        <label for="editLinkTopic" class="form-label">Topic</label>
                        <select class="form-select" id="editLinkTopic" name="topic" required>
                            {% for topic in topics %}
                            <option value="{{ topic.name }}">{{ topic.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="editLinkUrl" class="form-label">URL</label>
                        <input type="url" class="form-control" id="editLinkUrl" name="url" required>
                    </div>
                    <div class="mb-3">
                        <label for="editLinkTitle" class="form-label">Title</label>
                        <input type="text" class="form-control" id="editLinkTitle" name="title" required>
                    </div>
                    <div class="mb-3">
                        <label for="editLinkStatus" class="form-label">Status</label>
                        <select class="form-select" id="editLinkStatus" name="status" required>
                            <option value="new">New</option>
                            <option value="read">Read</option>
                            <option value="read-again">Read Again</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="editLinkSource" class="form-label">Source</label>
                        <input type="text" class="form-control" id="editLinkSource" name="source">
                    </div>
                    <div class="mb-3">
                        <label for="editLinkNotes" class="form-label">Notes</label>
                        <textarea class="form-control" id="editLinkNotes" name="notes" rows="3"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="submitEditForm()">Save Changes</button>
            </div>
        </div>
    </div>
</div>

<script>
    $(document).ready(function() {
        // ... existing DataTable initialization ...

        // Handle edit modal
        $('#editLinkModal').on('show.bs.modal', function (event) {
            var button = $(event.relatedTarget);
            var linkId = button.data('link-id');
            var linkTopic = button.data('link-topic');
            var linkUrl = button.data('link-url');
            var linkTitle = button.data('link-title');
            var linkStatus = button.data('link-status');
            var linkSource = button.data('link-source');
            var linkNotes = button.data('link-notes');
            
            var modal = $(this);
            modal.find('#editLinkId').val(linkId);
            modal.find('#editLinkTopic').val(linkTopic);
            modal.find('#editLinkUrl').val(linkUrl);
            modal.find('#editLinkTitle').val(linkTitle);
            modal.find('#editLinkStatus').val(linkStatus);
            modal.find('#editLinkSource').val(linkSource);
            modal.find('#editLinkNotes').val(linkNotes);
        });

        // Handle status changes
        $('.status-select').change(function() {
            const linkId = $(this).data('link-id');
            const newStatus = $(this).val();
            
            fetch(`/link/status/${linkId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ status: newStatus })
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
            })
            .catch(error => {
                console.error('Error updating status:', error);
                alert('Failed to update status. Please try again.');
            });
        });
    });

    function submitEditForm() {
        var form = document.getElementById('editLinkForm');
        var linkId = document.getElementById('editLinkId').value;
        form.action = '/link/edit/' + linkId;
        form.submit();
    }
</script> 